testName=$1
dockerComposeSystem=$2
logFile=$3

$dockerComposeApp="$HOLOCHAIN_APPDIR/runtime/docker/docker-compose.runCluster.yml"
ln $dockerComposeSystem $dockerComposeApp

export HC_SCALE=`ls ../../Scripts/cluster/hc -1 | wc -l`

#take down network
docker-compose -f $dockerComposeApp down
#rebuild all images
docker-compose -f $dockerComposeApp build --no-cache
#set scale
#TODO deprecated - should be in docker-compose up --scale....
echo "docker-compose -f $dockerComposeApp scale hc=$HC_SCALE"
docker-compose -f $dockerComposeApp scale "hc=$HC_SCALE"
#bring network up
echo "docker-compose -f $dockerComposeApp up | tee ./$testName.output"
docker-compose -f $dockerComposeApp up | tee -a $logFile

#TODO MAKE TEST PASS / FAIL AUTOMATICALLY PASS THROUGH TO BUILD SYSTEM
#[ -f $HOLOCHAIN_APPDIR/runtime/tests/passed ] || { echo "HC: ---- FAILED" && exit 1 ; }